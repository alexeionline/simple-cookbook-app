var cookbook;cookbook=new Backbone.Marionette.Application();cookbook.Models={};cookbook.Views={};cookbook.Collections={};cookbook.Models.Recipe=Backbone.Model.extend();cookbook.Collections.Recipes=Backbone.Collection.extend({url:"/api/v1/recipes",model:cookbook.Models.Recipe,comparator:function(a){return -a.get("date")}});cookbook.Views.RecipeView=Backbone.Marionette.ItemView.extend({tagName:"li",template:"#recipeViewState",templateHelpers:{getTime:function(){return moment(this.date).format("MMMM Do YYYY, h:mm:ss a")}},events:{"click .rcp-btn-vw":"showRecipeInfo","click .rcp-btn-edt":"editRecipeInfo"},showRecipeInfo:function(){cookbook.mainRouter.navigate(this.model.get("recipeID")+"/a/"+this.model.get("id"),{trigger:true})},editRecipeInfo:function(){cookbook.mainRouter.navigate(this.model.get("id")+"/edit",{trigger:true})}});cookbook.Views.RecipeEdit=Backbone.Marionette.ItemView.extend({template:"#recipeEditState",templateHelpers:{getTime:function(){return moment(this.date).format("MMMM Do YYYY, h:mm:ss a")}},events:{"click .rcp-btn-sv":"saveEditedRecipe","click .rcp-btn-cnl":"showRecipeInfo"},ui:{description:"textarea[name=description]",errorMsg:".rcp-err-msg"},saveEditedRecipe:function(){if(this.model.get("description")===this.ui.description.val()){this.ui.errorMsg.text("Description was not changed").show()}else{if(this.ui.description.val()===""){this.ui.errorMsg.text("Description is required").show()}else{this.ui.errorMsg.hide();cookbook.recipes.create({recipeID:this.model.get("recipeID"),title:this.model.get("title"),description:this.ui.description.val()},{wait:true})}}},showRecipeInfo:function(){cookbook.mainRouter.navigate(this.model.get("recipeID")+"/a/"+this.model.get("id"),{trigger:true})}});cookbook.Views.RecipeNew=Backbone.Marionette.ItemView.extend({template:"#recipeNewState",events:{"click .rcp-btn-sv":"saveNewRecipe","click .rcp-btn-cnl":"showRecipesList"},ui:{title:"input[name=title]",description:"textarea[name=description]",errorMsg:".rcp-err-msg"},saveNewRecipe:function(){if(this.ui.title.val()===""){this.ui.errorMsg.text("Title is required").show()}else{if(this.ui.description.val()===""){this.ui.errorMsg.text("Description is required").show()}else{this.ui.errorMsg.hide();cookbook.recipes.create({title:this.ui.title.val(),description:this.ui.description.val()},{wait:true})}}},showRecipesList:function(){cookbook.mainRouter.navigate("list",{trigger:true})}});cookbook.Views.Recipes=Backbone.Marionette.CollectionView.extend({tagName:"ul",className:"rcp-lst",initialize:function(a){this.activeID=a.activeID},onRender:function(){if(this.activeID){this.$el.find("[data-id="+this.activeID+"]").addClass("actv")}},itemView:cookbook.Views.RecipeView});cookbook.AppLayout=Backbone.Marionette.Layout.extend({el:".cookbook",template:"#appLayout-tmpl",regions:{content:".pg-cnt"},events:{"click .nw-rcp-btn":"createNewRecipe","click .pg-hd-tl a":"showRecipesList"},createNewRecipe:function(){cookbook.mainRouter.navigate("new",{trigger:true})},showRecipesList:function(a){a.preventDefault();cookbook.mainRouter.navigate("list",{trigger:true})}});cookbook.MainRouter=Backbone.Marionette.AppRouter.extend({routes:{list:"showRecipesList","new":"newRecipe",":id/edit":"editRecipe",":recipeID/a/:id":"showRecipe"},showRecipesList:function(){var b,a;cookbook.recipes.sort();b=new cookbook.Collections.Recipes(_.uniq(cookbook.recipes.models,function(c){return c.get("recipeID")}));a=new cookbook.Views.Recipes({collection:b});cookbook.applayout.content.show(a)},showRecipe:function(a,d){var c,b;c=new cookbook.Collections.Recipes(cookbook.recipes.where({recipeID:a}));b=new cookbook.Views.Recipes({collection:c,activeID:d});cookbook.applayout.content.show(b)},editRecipe:function(c){var b,a;b=cookbook.recipes.findWhere({id:c});a=new cookbook.Views.RecipeEdit({model:b});cookbook.applayout.content.show(a)},newRecipe:function(){var a;a=new cookbook.Views.RecipeNew;cookbook.applayout.content.show(a)}});cookbook.addInitializer(function(){cookbook.recipes=new cookbook.Collections.Recipes;cookbook.recipes.fetch({success:function(){cookbook.mainRouter=new cookbook.MainRouter;Backbone.history.start();cookbook.recipes.listenTo(cookbook.recipes,"add",function(a){cookbook.mainRouter.navigate(a.get("recipeID")+"/a/"+a.get("id"),{trigger:true})});if(!Backbone.history.fragment){cookbook.mainRouter.navigate("list",{trigger:true})}}})});cookbook.addInitializer(function(){cookbook.applayout=new cookbook.AppLayout();cookbook.applayout.render()});cookbook.start();